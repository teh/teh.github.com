(this.webpackJsonpstg=this.webpackJsonpstg||[]).push([[0],[,,,,function(e,n,a){e.exports=a(11)},,,,,function(e,n,a){},function(e,n,a){},function(e,n,a){"use strict";a.r(n);var t=a(0),r=a.n(t),l=a(2),i=a.n(l),s=(a(9),a(3));a(10);function o(e){throw new Error("unreachable")}var u=function(e){return{kind:"Var",name:e}},c=function(e){return{kind:"Literal",name:e,value:0}},m=0,d=function(){return{kind:"Var",name:"$".concat(m++)}},p=[],g=function(){return{nil:{kind:"CON",tag:"Nil",payload:[]},zero:{kind:"CON",tag:"I",payload:[{kind:"Literal",name:"-",value:0}]},one:{kind:"CON",tag:"I",payload:[{kind:"Literal",name:"-",value:1}]},two:{kind:"CON",tag:"I",payload:[{kind:"Literal",name:"-",value:2}]},three:{kind:"CON",tag:"I",payload:[{kind:"Literal",name:"-",value:3}]},plusInt:{kind:"FUN",arguments:[u("x"),u("y")],expression:{kind:"Case",expression:u("x"),alternatives:[{kind:"Alternative",tag:"I",bindingName:[c("i")],expression:{kind:"Case",expression:u("y"),alternatives:[{kind:"Alternative",tag:"I",bindingName:[c("j")],expression:{kind:"Case",expression:{kind:"PrimPlus",a1:c("i"),a2:c("j")},alternatives:[{kind:"Alternative",tag:"default",bindingName:[u("result")],expression:{kind:"Let",name:"value",newObject:{kind:"CON",tag:"I",payload:[u("result")]},in:u("value")}}]}}]}}]}},foldl:{kind:"FUN",arguments:[u("f"),u("acc"),u("list")],expression:{kind:"Case",expression:u("list"),alternatives:[{kind:"Alternative",tag:"Nil",bindingName:[],expression:u("acc")},{kind:"Alternative",tag:"Cons",bindingName:[u("h"),u("t")],expression:{kind:"Let",name:"newAcc",newObject:{kind:"THUNK",expression:{kind:"FunctionApply",f:u("f"),arguments:[u("acc"),u("h")]}},in:{kind:"FunctionApply",f:u("foldl"),arguments:[u("f"),u("newAcc"),u("t")]}}}]}},sum:{kind:"FUN",arguments:[u("list")],expression:{kind:"FunctionApply",f:u("foldl"),arguments:[u("plusInt"),u("zero"),u("list")]}},list1:{kind:"CON",tag:"Cons",payload:[u("one"),u("nil")]},list2:{kind:"CON",tag:"Cons",payload:[u("two"),u("list1")]},list3:{kind:"CON",tag:"Cons",payload:[u("three"),u("list2")]},main:{kind:"THUNK",expression:{kind:"FunctionApply",f:u("sum"),arguments:[u("list3")]}}}},f=g(),k=function e(n,a,t){var r=function(e){return e.name===a.name?t:e},l=function(e){return e.name===a.name?t:e},i=function(e){return e.name===a.name?t:e};switch(n.kind){case"FunctionApply":return{kind:n.kind,f:r(n.f),arguments:n.arguments.map(l)};case"Case":return{kind:n.kind,expression:e(n.expression,a,t),alternatives:n.alternatives.map((function(n){return{kind:"Alternative",tag:n.tag,expression:e(n.expression,a,t),bindingName:n.bindingName}}))};case"Let":return{kind:n.kind,in:e(n.in,a,t),newObject:function n(i){switch(i.kind){case"THUNK":return{kind:i.kind,expression:e(i.expression,a,t)};case"CON":return{kind:i.kind,tag:i.tag,payload:i.payload.map((function(e){return l(n(e))}))};case"FUN":return{kind:i.kind,arguments:i.arguments,expression:e(i.expression,a,t)};case"PAP":return{kind:i.kind,f:r(i.f),arguments:i.arguments.map((function(e){return l(e)}))}}return i}(n.newObject),name:n.name};case"Var":return n.name===a.name?t:n;case"PrimPlus":return{kind:n.kind,a1:i(n.a1),a2:i(n.a2)};case"Literal":throw new Error("literal can't be substituted")}o()},v=function(e){switch(e.kind){case"Literal":var n=p[p.length-1];if(void 0!==n&&"CaseCont"===n.kind){p.pop();var a=n.alternatives[0];if(a&&"default"===a.tag){var t=c(a.bindingName[0].name);t.value=e.value;var r=k(a.expression,a.bindingName[0],t);return console.log("SUBST",r),r}}throw new Error("no default literal case alternative");case"Var":var l=f[e.name];switch(l.kind){case"FUN":return console.log("--- FUN"),e;case"PAP":return console.log("--- PAP"),e;case"CON":var i=p[p.length-1];if(void 0!==i&&"CaseCont"===i.kind){p.pop(),console.log("stackTop.alternatives",i.alternatives[0]);var s=!0,m=!1,g=void 0;try{for(var v,h=i.alternatives[Symbol.iterator]();!(s=(v=h.next()).done);s=!0){var N=v.value;if(N.tag===l.tag)switch(N.tag){case"Nil":return N.expression;case"Cons":var C=l.payload[0],w=l.payload[1],E=k(N.expression,N.bindingName[0],C);return E=k(E,N.bindingName[1],w);case"I":return k(N.expression,N.bindingName[0],{kind:"Literal",name:N.bindingName[0].name,value:l.payload[0].value})}}}catch(S){m=!0,g=S}finally{try{s||null==h.return||h.return()}finally{if(m)throw g}}var y=!0,x=!1,b=void 0;try{for(var O,A=i.alternatives[Symbol.iterator]();!(y=(O=A.next()).done);y=!0){var L=O.value;if("default"===L.tag)return console.log("default case"),L.expression}}catch(S){x=!0,b=S}finally{try{y||null==A.return||A.return()}finally{if(x)throw b}}}else if(void 0!==i&&"UpdateCont"===i.kind)return p.pop(),console.log("stack\n",p),console.log("stackTop.update-var",i.var,"with",e.name),f[i.var.name]=f[e.name],e;return null;case"THUNK":return console.log("THUNK",e),f[e.name]={kind:"BLACKHOLE"},p.push({kind:"UpdateCont",var:e}),l.expression;case"BLACKHOLE":throw new Error("loopy")}throw new Error("unhandled");case"PrimPlus":var U=c("-");return U.value=e.a1.value+e.a2.value,U;case"Let":var F=d();return f[F.name]=e.newObject,k(e.in,u(e.name),F);case"FunctionApply":if("Var"===e.f.kind){var P=f[e.f.name];switch(P.kind){case"FUN":if(console.log("FUN",P.arguments.length,e.arguments.length),P.arguments.length===e.arguments.length){for(var I=P.expression,T=0;T<P.arguments.length;T++)I=k(I,P.arguments[T],e.arguments[T]);return console.log("substituted",I),I}if(P.arguments.length>e.arguments.length){p.push({kind:"ApplyToArgs",arguments:P.arguments.slice(e.arguments.length,P.arguments.length)});for(var j=e.f,H=0;H<e.arguments.length;H++)j=k(j,P.arguments[H],e.arguments[H]);return j}if(P.arguments.length>e.arguments.length){var K=d();return f[K.name]={kind:"PAP",f:e.f,arguments:e.arguments.slice(0,e.arguments.length)},K}}}return e.f;case"Case":return p.push({kind:"CaseCont",alternatives:e.alternatives}),e.expression}o()},h=function(e){switch(e.kind){case"Literal":return e.value.toString();case"Var":return e.name}},N=function(e,n){switch(n.kind){case"BLACKHOLE":return r.a.createElement("span",null,e,": BLACKHOLE");case"FUN":return r.a.createElement("span",null,e,": FUN(",n.arguments.map((function(e){return e.name})).join(" "),")");case"CON":return r.a.createElement("span",null,e,": CON(",n.tag," ",n.payload.map((function(e){return h(e)})).join(" "),")");case"PAP":return r.a.createElement("span",null,e,": PAP");case"THUNK":return r.a.createElement("span",null,e,": THUNK (",C(n.expression),")")}},C=function e(n){switch(n.kind){case"Case":return r.a.createElement("span",null,"Case (",e(n.expression),") of");case"FunctionApply":return r.a.createElement("span",null,"FunctionApply ",h(n.f));case"Let":return r.a.createElement("span",null,"Let ",n.name," in ",N(n.name,n.newObject));case"Literal":return r.a.createElement("span",null,"Literal");case"Var":return r.a.createElement("span",null,"Var ",n.name);case"PrimPlus":return r.a.createElement("span",null,h(n.a1)," + ",h(n.a2))}},w=function(){var e=Object(t.useState)(0),n=Object(s.a)(e,2),a=n[0],l=n[1],i={kind:"Var",name:"main"};f=g(),m=0,p.splice(0,p.length);for(var o=0;o<a&&(console.log(i),null!=i);o++)i=v(i);var u=function(e){"ArrowLeft"===e.key&&a>0&&l(a-1),"ArrowRight"===e.key&&null!=i&&l(a+1)};return Object(t.useEffect)((function(){return window.addEventListener("keydown",u),function(){window.removeEventListener("keydown",u)}}),[a]),r.a.createElement("div",{className:"stackheap"},r.a.createElement("div",{className:"description"},r.a.createElement("h2",null,"Spineless Tagless G machine simulator (STG)"),r.a.createElement("p",null,"Use the left (",r.a.createElement("span",{"aria-label":"step back",role:"img"},"\u2b05\ufe0f"),") and right (",r.a.createElement("span",{"aria-label":"step forward",role:"img"},"\u27a1\ufe0f"),") arrow keys to step."),r.a.createElement("p",null,"This page simulates a very simple version of the STG machine with eval/apply calling conventions. Read the ",r.a.createElement("a",{href:"TODO"},"blog post")," for details."),r.a.createElement("div",{className:"step-value"},"Step: ",a),r.a.createElement("div",{className:"expression-value"},null===i?null:C(i)),r.a.createElement("hr",null),r.a.createElement("pre",null,"\nnil = CON(Nil);\nzero = CON(I 0);\none = CON(I 1);\ntwo = CON(I 2);\nthree = CON(I 3);\n\nplusInt = FUN(x y ->\n  case x of {\n    I i -> case y of {\n      I j -> case plus# i j of {\n        x -> let { result = CON (I x) } in result }}});\n\nfoldl = FUN(f acc list ->\n  case list of {\n    Nil -> acc;\n    Cons h t -> let {\n      newAcc = THUNK(f acc h)\n    } in foldl f newAcc t\n  });\n\n  # lazy sum with a well-known space leak\n  sum = FUN(list -> foldl plusInt zero list);\n\n  list1 = CON(Cons one nil);\n  list2 = CON(Cons two list1);\n  list3 = CON(Cons three list2);\n\n  main = THUNK(sum list3);\n          "),r.a.createElement("a",{href:"https://wiki.haskell.org/Ministg#Source_language"},"Program borrowed from here")),r.a.createElement("div",{className:"stack"},r.a.createElement("h2",null,"Stack"),r.a.createElement("ul",null,p.map((function(e){return r.a.createElement("li",null,function(e){switch(e.kind){case"ApplyToArgs":return r.a.createElement("span",null,"ApplyToArgs");case"CaseCont":return r.a.createElement("span",null,"CaseCont ",r.a.createElement("br",null),e.alternatives.map((function(e){return r.a.createElement("span",{className:"casecont-branch"},e.tag," ",e.bindingName.map((function(e){return e.name})).join(" ")," -> ...",r.a.createElement("br",null))})));case"UpdateCont":return r.a.createElement("span",null,"UpdateCont ",r.a.createElement("span",{className:"heap-object"},h(e.var)))}}(e))})))),r.a.createElement("div",{className:"heap"},r.a.createElement("h2",null,"Heap"),r.a.createElement("ul",null,Object.keys(f).map((function(e){var n;return r.a.createElement("li",{className:"Var"===(null===(n=i)||void 0===n?void 0:n.kind)&&i.name===e?"heap-var-active":""},N(e,f[e]))})))))};i.a.render(r.a.createElement(w,null),document.getElementById("root"))}],[[4,1,2]]]);
//# sourceMappingURL=main.3ae42999.chunk.js.map